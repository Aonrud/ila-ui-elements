/*! ILA UI Elements
 *Copyright (C) 2021-2022 Aonghus Storey
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).ila={})}(this,(function(t){"use strict";function i(t,i){let s={};for(const o in t)s[o]=i[o]??t[o];return s}const s={leftButtonClass:"scroller-left btn btn-scroller",rightButtonClass:"scroller-right btn btn-scroller",leftButtonContent:"⮈",rightButtonContent:"⮊",breakpoints:[[0,4],[768,4],[992,6],[1200,8]]};const o={targetClass:"viewer",panzoom:!1,showDownload:!1,showLink:!0,btnCueText:"⨁",btnHideText:"ⓧ",btnDownloadText:"⮋",btnPrevText:"⮈",btnNextText:"⮊",btnLinkText:"⛓",btnZoomText:"🞕",btnZoomTextActive:"🞔",btnCueIcon:"",btnHideIcon:"",btnDownloadIcon:"",btnPrevIcon:"",btnNextIcon:"",btnLinkIcon:"",btnZoomIcon:"",btnZoomIconActive:""};t.ImageViewer=class{strings={titleHide:"Close",titlePrev:"Previous image",titleNext:"Next image",titleZoom:"Enlarge image (drag to move the image around)",titleZoomActive:"Reset image to fit screen",titleZoomDisabled:"Zoom disabled (the image is already full size)",titleDownload:"Download this image",titleLink:"More information"};constructor(t={}){this.t=i(o,t),this.i=document.querySelectorAll("img."+this.t.targetClass)}create(){this.o(),this.h()}next(){const t=this.l===this.i.length-1?0:this.l+1;this.show(t)}prev(){const t=0===this.l?this.i.length-1:this.l-1;this.show(t)}hide(){this.u&&(this.m.style.display="none",document.body.style.overflow="visible",this.m.blur(),this.u=!1)}show(t=0){document.getElementById("overlay")||document.body.append(this.m),this.t.panzoom&&(this.p=this.p??Panzoom(this.g,{disableZoom:!0,noBind:!0})),this.u||(this.m.style.display="block",document.body.style.overflow="hidden",this.m.focus(),this.u=!0),Number.isInteger(t)&&this.v(t)}v(t){const i=this.i[t];this.l=t,this.g.src=i.dataset.full??i.src,this.g.setAttribute("alt",i.getAttribute("alt"));const s=this.m.querySelector(".caption"),o=this.i[t].parentElement.nextElementSibling;o&&("FIGCAPTION"===o.tagName||o.classList.contains("caption"))?(s.textContent=o.textContent,s.style.display="block"):s.style.display="none"}zoom(t){const i=t.currentTarget,s=[...i.childNodes].filter((t=>t.nodeType===Node.TEXT_NODE))[0];i.classList.contains("zoomed")?(this.zoomToggle(!1),s.textContent=this.t.btnZoomText,this.t.btnZoomIcon&&(i.querySelector("span").className=this.t.btnZoomIcon),i.setAttribute("title",this.strings.titleZoom)):(this.zoomToggle(!0),s.textContent=this.t.btnZoomTextActive,this.t.btnZoomIconActive&&(i.querySelector("span").className=this.t.btnZoomIconActive),i.setAttribute("title",this.strings.titleZoomActive)),i.classList.toggle("zoomed")}zoomToggle(t=!0){const i=this.p;if(this.g.classList.toggle("pan"),t)return i.bind(),void i.setStyle("cursor","move");i.reset({animate:!1}),i.setStyle("cursor","auto"),i.destroy()}h(){const t=document.createElement("div");t.classList.add("image-wrap");const i=document.createElement("img");i.addEventListener("load",(()=>this.I())),t.append(i);const s=document.createElement("div");s.classList.add("caption");const o=document.createElement("div");o.id="overlay",o.setAttribute("tabindex",-1),o.append(t),o.append(s),o.append(this.k()),o.addEventListener("keydown",(t=>this._(t))),this.m=o,this.g=i}o(){for(const[t,i]of this.i.entries()){let s=i.parentElement;"A"!==s.tagName&&(s=document.createElement("a"),i.parentElement.insertBefore(s,i),s.append(i)),s.classList.add("viewer-wrap");const o=document.createElement("div");o.classList.add("cue"),o.textContent=this.t.btnCueText,this.t.btnCueIcon&&this.$(this.t.btnCueIcon,o),s.append(o),s.addEventListener("click",(i=>{i.preventDefault(),this.show(t)}))}}k(){const t=document.createElement("nav");t.classList.add("image-viewer-controls"),t.setAttribute("aria-label","Image Viewer Controls");const i=["Hide","Prev","Next"],s=["Download","Link"];for(const s of i)t.append(this.T(s));this.t.panzoom&&t.append(this.T("Zoom"));for(const i of s)if(this.t[`show${i}`]){let s=document.createElement("a");s.id=`btn${i}`,t.append(s)}for(const i of t.children)i.textContent=this.t[`${i.id}Text`],this.t[`${i.id}Icon`]&&this.$(this.t[`${i.id}Icon`],i),this.strings[`title${i.id.replace("btn","")}`]&&i.setAttribute("title",this.strings[`title${i.id.replace("btn","")}`]);return t}I(){const t=this.g,i=this.l;if(this.t.showDownload){const i=document.getElementById("btnDownload");i.href=t.src,i.setAttribute("download","")}if(this.t.showLink){const t=document.getElementById("btnLink");this.i[i].dataset.link?(t.href=this.i[i].dataset.link,t.style.display="block"):(t.removeAttribute("href"),t.style.display="none")}if(this.t.panzoom){const i=document.getElementById("btnZoom");t.width<t.naturalWidth?(i.disabled=!1,i.setAttribute("title",this.strings.titleZoom)):(i.disabled=!0,i.setAttribute("title",this.strings.titleZoomDisabled))}}T(t){let i=document.createElement("button");return i.id=`btn${t}`,i.setAttribute("type","button"),"function"==typeof this[t.toLowerCase()]&&i.addEventListener("click",(i=>this[t.toLowerCase()](i))),i}_(t){const i={Escape:"hide",ArrowLeft:"prev",ArrowRight:"next"};i.hasOwnProperty(t.key)&&"function"==typeof this[i[t.key]]&&(t.preventDefault(),this[i[t.key]]())}$(t,i){const s=document.createElement("span");s.classList.add(...t.split(" ")),i.append(s)}},t.Scroller=class{constructor(t,o={}){this.C=t,this.t=i(s,o),this.Z(),this.N=null,this.D>this.L&&this.create()}create(){if(this.C.parentNode==this.B&&"hidden"==this.B.style.overflow)return;const t='<button class="'+this.t.leftButtonClass+' disabled">'+this.t.leftButtonContent+'</button><button class="'+this.t.rightButtonClass+'">'+this.t.rightButtonContent+"</button>";this.A(),this.B.style.overflow="hidden",this.B.insertAdjacentHTML("beforeend",t),this.B.addEventListener("click",(t=>this.P(t))),window.addEventListener("resize",(t=>this.H())),this.M=this.B.querySelector(".scroller-left"),this.O=this.B.querySelector(".scroller-right"),this.C.style.left="0px",this.M.disabled=!0,this.M.classList.add("disabled")}H(){clearTimeout(this.N),this.N=setTimeout(this.Z(),1e3)}destroy(){this.C.style.left="0px",this.M.remove(),this.O.remove(),window.removeEventListener("resize",this.H),this.R()}scrollLeft(){const t=parseInt(this.C.style.left);let i=t+this.j;this.O.classList.contains("disabled")&&(i=t+this.F%this.j),i>=0&&(i=0,this.M.disabled=!0,this.M.classList.add("disabled")),this.C.style.left=i+"px",this.O.disabled=!1,this.O.classList.remove("disabled"),console.log(`Moving from ${t} to ${i}`)}scrollRight(){const t=parseInt(this.C.style.left);let i=t-this.j;i<-this.F&&(i=-this.F,this.O.disabled=!0,this.O.classList.add("disabled")),this.C.style.left=i+"px",this.M.disabled=!1,this.M.classList.remove("disabled"),console.log(`Moving from ${t} to ${i}`)}A(){const t=document.createElement("div");t.classList.add("scroller-wrapper"),this.C.parentNode.insertBefore(t,this.C),t.append(this.C),this.B=t,this.Z()}R(){this.B.parentNode.insertBefore(this.C,this.B.previousSibling),this.B.remove()}Z(){const t=window.innerWidth,i=this.G(t,this.t.breakpoints);this.S(i);let s=window.getComputedStyle(this.C);const o=parseInt(s.getPropertyValue("padding-left"))+parseInt(s.getPropertyValue("padding-right"));this.D=this.C.scrollWidth-o,this.L=this.C.offsetWidth-o,this.V=this.C.querySelector("li").offsetWidth,this.q=Math.floor(this.L/this.V),this.j=this.V*this.q,this.F=this.D-this.L,console.log(`Content: ${this.D}; Display: ${this.L}.`)}G(t,i){for(let s=0;s<i.length;s++)if(i[s][0]<=t&&(s==i.length-1||i[s+1][0]>t))return i[s][1]}S(t){if(isNaN(t))throw new Error(`Invalid number provided for row count: ${t}`);console.log(`Setting row count to ${t}`);const i=this.C.querySelectorAll(".scroller li"),s=100/t+"%";for(const t of i)t.style.flexBasis=s}P(t){t.target.classList.contains("scroller-left")&&this.scrollLeft(),t.target.classList.contains("scroller-right")&&this.scrollRight()}},Object.defineProperty(t,"J",{value:!0})}));
